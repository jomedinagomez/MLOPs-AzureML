Azure ML Infrastructure Deployment Outputs
==========================================
Generated: July 30, 2025
Environment: dev
Location: canadacentral
Random String: 004

CORE RESOURCES
==============

Azure ML Workspace
------------------
Name: amldevcc004
ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-ws-dev-cc/providers/Microsoft.MachineLearningServices/workspaces/amldevcc004
Resource Group: rg-aml-ws-dev-cc

Azure ML Registry
-----------------
Name: amlrdevcc004
ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-reg-dev-cc/providers/Microsoft.MachineLearningServices/registries/amlrdevcc004
Resource Group: rg-aml-reg-dev-cc

Storage Account
---------------
Name: stdevcc004
ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-ws-dev-cc/providers/Microsoft.Storage/storageAccounts/stdevcc004

Container Registry
------------------
Name: acrdevcc004
ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-ws-dev-cc/providers/Microsoft.ContainerRegistry/registries/acrdevcc004

Key Vault
---------
Name: kvdevcc004
ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.KeyVault/vaults/kvdevcc004

NETWORKING
==========

Virtual Network
---------------
Name: vnet-amldevcc004
ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/virtualNetworks/vnet-amldevcc004
Resource Group: rg-aml-vnet-dev-cc

Subnet
------
Name: subnet-amldevcc004
ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/virtualNetworks/vnet-amldevcc004/subnets/subnet-amldevcc004

Private DNS Zones
-----------------
ACR: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/privateDnsZones/privatelink.azurecr.io
AML API: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/privateDnsZones/privatelink.api.azureml.ms
AML Notebooks: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/privateDnsZones/privatelink.notebooks.azure.net
Blob Storage: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/privateDnsZones/privatelink.blob.core.windows.net
File Storage: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/privateDnsZones/privatelink.file.core.windows.net
Key Vault: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net
Queue Storage: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/privateDnsZones/privatelink.queue.core.windows.net
Table Storage: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/privateDnsZones/privatelink.table.core.windows.net

MANAGED IDENTITIES
==================

Compute Cluster Identity
-------------------------
Name: dev-mi-cluster
ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.ManagedIdentity/userAssignedIdentities/dev-mi-cluster

Managed Online Endpoint Identity
---------------------------------
Name: dev-mi-endpoint
ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.ManagedIdentity/userAssignedIdentities/dev-mi-endpoint

COMPUTE RESOURCES
=================

Compute Cluster
---------------
Name: cpu-cluster-uami
Type: Azure ML Compute Cluster
Configuration: User-assigned managed identity enabled
Location: Within workspace amldevcc004

PIPELINE CONFIGURATION UPDATES NEEDED
=====================================

Current Pipeline File: pipelines/taxi-fare-train-pipeline.yaml
Required Updates:

1. Registry Name (Line ~12):
   FROM: registry: 'amlrdevcc002'
   TO:   registry: 'amlrdevcc004'

2. Compute Target (Line 27):
   CURRENT: default_compute: azureml:cpu-cluster-uami
   STATUS: ✅ CORRECT (already matches deployed compute cluster)

MONITORING & DIAGNOSTICS
========================

Log Analytics Workspace
------------------------
Name: log-amldevcc004
ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.OperationalInsights/workspaces/log-amldevcc004

Diagnostic Settings Configured:
- ✅ Azure ML Workspace diagnostics
- ✅ Azure ML Registry diagnostics
- ✅ Storage Account diagnostics (metrics)
- ✅ Storage Services diagnostics (blob, file, queue, table - logs + metrics)
- ✅ Container Registry diagnostics
- ✅ Key Vault diagnostics
- ✅ Virtual Network diagnostics
- ✅ Application Insights diagnostics
- ✅ Registry Managed Resources diagnostics (automated PowerShell script)

SECURITY & ACCESS
=================

Role Assignments Configured:
- ✅ Azure AI Enterprise Network Connection Approver
- ✅ Storage Blob Data Contributor
- ✅ Storage File Data Privileged Contributor
- ✅ Key Vault Secrets User
- ✅ AzureML Data Scientist
- ✅ AzureML Compute Operator
- ✅ Azure AI Developer
- ✅ Registry User permissions

Network Security:
- ✅ Private endpoints for all services
- ✅ Storage network access rules configured
- ✅ Workspace outbound rules to registry
- ✅ Private DNS resolution configured

DEPLOYMENT STATUS
=================

Infrastructure Deployment: ✅ COMPLETE
Registry Managed Resources Diagnostics: ✅ COMPLETE
Network Configuration: ✅ COMPLETE
Security Configuration: ✅ COMPLETE
Monitoring Setup: ✅ COMPLETE

NEXT STEPS FOR PIPELINE
=======================

1. Update Pipeline Configuration:
   - Change registry name from 'amlrdevcc002' to 'amlrdevcc004' in taxi-fare-train-pipeline.yaml
   
2. Verify Pipeline Dependencies:
   - Ensure all component files exist in ../src/components/
   - Verify data files exist in ../data/taxi-data/raw/
   
3. Test Pipeline Execution:
   - Submit pipeline to workspace amldevcc004
   - Monitor execution in Azure ML Studio

USEFUL COMMANDS
===============

Azure CLI Login:
az login

Set Default Workspace:
az configure --defaults group=rg-aml-ws-dev-cc workspace=amldevcc004

Submit Pipeline:
az ml job create --file pipelines/taxi-fare-train-pipeline.yaml --workspace-name amldevcc004 --resource-group rg-aml-ws-dev-cc

Monitor Pipeline:
az ml job show --name <job-name> --workspace-name amldevcc004 --resource-group rg-aml-ws-dev-cc

ENVIRONMENT VARIABLES FOR SCRIPTS
==================================

export AZURE_ML_WORKSPACE_NAME="amldevcc004"
export AZURE_ML_RESOURCE_GROUP="rg-aml-ws-dev-cc"
export AZURE_ML_REGISTRY_NAME="amlrdevcc004"
export AZURE_STORAGE_ACCOUNT="stdevcc004"
export AZURE_CONTAINER_REGISTRY="acrdevcc004"
export AZURE_KEY_VAULT="kvdevcc004"
export AZURE_SUBSCRIPTION_ID="5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25"

TROUBLESHOOTING
===============

If pipeline fails with compute issues:
- Verify compute cluster 'cpu-cluster-uami' is running
- Check managed identity permissions
- Ensure network connectivity through private endpoints

If registry access fails:
- Verify registry name is 'amlrdevcc004'
- Check outbound rules from workspace to registry
- Validate role assignments for registry access

If storage access fails:
- Check storage network access rules
- Verify managed identity has Storage Blob Data Contributor role
- Ensure private endpoints are properly configured

CONTACT & SUPPORT
=================

Infrastructure Owner: JoseMedina
Creation Date: July 30, 2025
Terraform State: Managed in infra/ directory
Documentation: This file serves as the primary reference for deployed resources

ACCESS SOLUTION - WINDOWS JUMP BOX
===================================

JUMP BOX DETAILS
================

Windows VM
----------
Name: ml-jumpbox-win
Resource Group: rg-aml-vnet-dev-cc
Size: Standard_D4s_v3 (4 vCPUs, 16 GB RAM)
OS: Windows Server 2022 Datacenter
Private IP: 10.1.1.16
Username: azureuser
Password: P@ssw0rd123!
VM ID: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Compute/virtualMachines/ml-jumpbox-win

Azure Bastion
-------------
Name: bastion-amldev
DNS Name: bst-cd2cbc6e-bde4-402e-9aba-96b548ea3692.bastion.azure.com
Resource Group: rg-aml-vnet-dev-cc
Public IP: 4.205.248.41
Bastion IP: /subscriptions/5784b6a5-de3f-4fa4-8b8f-e5bb70ff6b25/resourceGroups/rg-aml-vnet-dev-cc/providers/Microsoft.Network/publicIPAddresses/bastion-pip

Additional Subnets
------------------
Bastion Subnet: AzureBastionSubnet (10.1.2.0/26)

HOW TO ACCESS AZURE ML WORKSPACE
=================================

Step 1: Connect to Jump Box
----------------------------
1. Go to https://portal.azure.com
2. Navigate to Virtual Machines → ml-jumpbox-win
3. Click "Connect" → "Connect via Bastion"
4. Enter credentials: azureuser / P@ssw0rd123!
5. Browser RDP session opens

Step 2: Setup Jump Box (First Time Only)
-----------------------------------------
Install Azure CLI:
```powershell
$ProgressPreference = 'SilentlyContinue'; Invoke-WebRequest -Uri https://aka.ms/installazurecliwindows -OutFile .\AzureCLI.msi; Start-Process msiexec.exe -Wait -ArgumentList '/I AzureCLI.msi /quiet'; rm .\AzureCLI.msi
```

Install Azure ML Extension:
```powershell
az extension add --name ml
```

Login and Configure:
```powershell
az login
az configure --defaults group=rg-aml-ws-dev-cc workspace=amldevcc004
```

Step 3: Run Your ML Pipeline
-----------------------------
```powershell
# Clone or transfer your project files
git clone https://github.com/jomedinagomez/MLOPs-AzureML.git
cd MLOPs-AzureML

# Submit pipeline
az ml job create --file pipelines/taxi-fare-train-pipeline.yaml

# Monitor pipeline
az ml job list
```

SECURITY ARCHITECTURE
=====================

Network Security:
✅ Azure ML Workspace: Private networking only
✅ VM Access: No public IP, Bastion-only access
✅ Outbound Rules: Managed network with approved destinations
✅ Storage: Private endpoints with network access rules
✅ Registry: Private endpoint access only

Access Pattern:
Your Computer → Azure Portal → Bastion → Windows VM → Azure ML Workspace

COST MANAGEMENT
===============

Estimated Monthly Costs (if running 24/7):
- Windows VM (Standard_D4s_v3): ~$140/month
- Azure Bastion: ~$150/month
- Core ML Infrastructure: ~$200/month

Cost Optimization:
- Stop VM when not in use: az vm deallocate --resource-group rg-aml-vnet-dev-cc --name ml-jumpbox-win
- Start VM when needed: az vm start --resource-group rg-aml-vnet-dev-cc --name ml-jumpbox-win

RESOURCE CLEANUP COMMANDS
==========================

Remove Jump Box (when no longer needed):
```bash
az vm delete --resource-group rg-aml-vnet-dev-cc --name ml-jumpbox-win --yes
az disk delete --resource-group rg-aml-vnet-dev-cc --name ml-jumpbox-win_disk1_* --yes
az network nic delete --resource-group rg-aml-vnet-dev-cc --name ml-jumpbox-winVMNic
```

Remove Bastion (if access no longer needed):
```bash
az network bastion delete --resource-group rg-aml-vnet-dev-cc --name bastion-amldev
az network public-ip delete --resource-group rg-aml-vnet-dev-cc --name bastion-pip
az network vnet subnet delete --resource-group rg-aml-vnet-dev-cc --vnet-name vnet-amldevcc004 --name AzureBastionSubnet
```

QUICK REFERENCE
===============

Connect to Jump Box:
https://portal.azure.com → VMs → ml-jumpbox-win → Connect → Bastion

Test ML Access (from Jump Box):
```powershell
az ml workspace show --name amldevcc004 --resource-group rg-aml-ws-dev-cc
az ml compute list
```

Submit Pipeline (from Jump Box):
```powershell
az ml job create --file pipelines/taxi-fare-train-pipeline.yaml
```
